1:HL["/stg/hp/_next/static/css/4726f99846488bfd.css",{"as":"style"}]
0:["JvaY80XsBmrmH_ageXfaP",[[["",{"children":["blog",{"children":["posts",{"children":[["id","%E5%A6%82%E4%BD%95%E5%85%B3%E9%97%ADCloudflare%E7%9A%84Access-policy","d"],{"children":["__PAGE__?{\"id\":\"如何关闭Cloudflare的Access-policy\"}",{}]}]}]}]},"$undefined","$undefined",true],"$L2",[[["$","link","0",{"rel":"stylesheet","href":"/stg/hp/_next/static/css/4726f99846488bfd.css","precedence":"next"}]],["$L3",null]]]]]
4:HL["/stg/hp/_next/static/css/789162ebc8c5e2e4.css",{"as":"style"}]
5:I{"id":"5904","chunks":["904:static/chunks/904-7bdff5f4c8d79faf.js","404:static/chunks/app/blog/page-1c699a6f6f7cdc35.js"],"name":"","async":false}
6:I{"id":"3660","chunks":["904:static/chunks/904-7bdff5f4c8d79faf.js","910:static/chunks/910-6409c82cf3f3543a.js","185:static/chunks/app/layout-f49ba5b2d9bb7134.js"],"name":"SakanaWidget","async":false}
7:I{"id":"7718","chunks":["272:static/chunks/webpack-b11d9ea85a814807.js","501:static/chunks/575debc0-737c1c5d81a19012.js","524:static/chunks/524-9ca1ace78685b623.js"],"name":"","async":false}
8:I{"id":"7771","chunks":["601:static/chunks/app/error-f60b6694a64054a4.js"],"name":"","async":false}
9:I{"id":"4765","chunks":["272:static/chunks/webpack-b11d9ea85a814807.js","501:static/chunks/575debc0-737c1c5d81a19012.js","524:static/chunks/524-9ca1ace78685b623.js"],"name":"","async":false}
b:I{"id":"4355","chunks":["904:static/chunks/904-7bdff5f4c8d79faf.js","910:static/chunks/910-6409c82cf3f3543a.js","185:static/chunks/app/layout-f49ba5b2d9bb7134.js"],"name":"Footer","async":false}
2:[["$","html",null,{"lang":"zh-Hans","children":[["$","head",null,{"children":["$","link",null,{"rel":"icon","href":"https://avatars.githubusercontent.com/u/45930107","sizes":"any"}]}],["$","body",null,{"children":["$","div",null,{"className":"flex flex-col gap-3 max-w-2xl p-4 my-0 mx-auto","children":[["$","nav",null,{"className":"flex gap-3","children":[["$","a",null,{"href":"/stg/hp","children":["$","button",null,{"className":"\n  rounded-xl px-3 py-2\n  text-xl text-red-900 text-center\n  bg-rose-300 hover:bg-rose-200\n  transition-all\n inline-block w-32","type":"button","children":"Home"}]}],["$","$L5",null,{"href":"/blog","children":["$","button",null,{"className":"\n  rounded-xl px-3 py-2\n  text-xl text-red-900 text-center\n  bg-rose-300 hover:bg-rose-200\n  transition-all\n inline-block w-32","type":"button","children":"Blog"}]}]]}],["$","$L6",null,{"className":"hidden lg:block fixed left-0 bottom-3"}],["$","$L6",null,{"className":"hidden lg:block fixed right-0 bottom-3","character":"takina"}],["$","main",null,{"children":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$8","errorStyles":[],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","posts","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","posts","children",["id","%E5%A6%82%E4%BD%95%E5%85%B3%E9%97%ADCloudflare%E7%9A%84Access-policy","d"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$La",null],"segment":"__PAGE__?{\"id\":\"如何关闭Cloudflare的Access-policy\"}"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/stg/hp/_next/static/css/789162ebc8c5e2e4.css","precedence":"next"}]]}],"segment":["id","%E5%A6%82%E4%BD%95%E5%85%B3%E9%97%ADCloudflare%E7%9A%84Access-policy","d"]},"styles":[]}],"segment":"posts"},"styles":[]}],"segment":"blog"},"styles":[]}]}],["$","$Lb",null,{}]]}]}]]}],null]
3:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"如何关闭 Cloudflare 的 Access policy (How to disable the Access policy of Cloudflare) - Pink Champagne's blog (Beta)"}],["$","meta","2",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
c:I{"id":"7457","chunks":["978:static/chunks/app/blog/posts/[id]/page-623a164c6042aa69.js"],"name":"Article","async":false}
a:["$","div",null,{"className":"markdown-body","children":[["$","div",null,{"children":[["$","h1",null,{"children":"如何关闭 Cloudflare 的 Access policy (How to disable the Access policy of Cloudflare)"}],["$","p",null,{"children":[["$","time",null,{"children":["Published at: ","2021-11-03"]}],["$","br",null,{}],["$","time",null,{"children":["Updated at: ","2021-11-03"]}]]}]]}],["$","$Lc",null,{"html":"<p>本文讲述如何在不绑定信用卡的情况下关闭 Cloudflare 的 Access policy。</p>\n<p>This post describes that how to disable the Access policy of Cloudflare without credit card.</p>\n<!-- more -->\n<!-- TOC -->\n<ul>\n<li><a href=\"#%E5%89%8D%E8%A8%80\">前言</a></li>\n<li><a href=\"#%E5%BF%85%E8%A6%81%E6%9D%A1%E4%BB%B6\">必要条件</a></li>\n<li><a href=\"#%E6%93%8D%E4%BD%9C%E6%B5%81%E7%A8%8B\">操作流程</a>\n<ul>\n<li><a href=\"#%E8%8E%B7%E5%8F%96%E8%87%AA%E5%B7%B1%E7%9A%84-identifier\">获取自己的 identifier</a></li>\n<li><a href=\"#%E8%8E%B7%E5%8F%96%E8%87%AA%E5%B7%B1%E7%9A%84-x-auth-key\">获取自己的 X-Auth-Key</a></li>\n<li><a href=\"#%E8%8E%B7%E5%8F%96-access-policy-%E7%9A%84-id\">获取 Access policy 的 ID</a></li>\n<li><a href=\"#%E5%85%B3%E9%97%AD-access-policy\">关闭 Access policy</a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99\">参考资料</a></li>\n</ul>\n<!-- /TOC -->\n<h2 id=\"前言\">前言</h2>\n<p>最近使用在使用 Cloudflare Pages 部署静态网页的过程中，不小心开启了 Access-policy，导致访问部署项目的历史版本都需要经过验证，但想进入关闭 Access-policy 的页面，必须要先绑定了信用卡。</p>\n<p>这次属实是被 Cloudflare 给恶心到了，还好找到了解决方法，也就是通过调用 API 的方式去关闭这个功能。</p>\n<h2 id=\"必要条件\">必要条件</h2>\n<ul>\n<li>熟悉 HTTP 协议接口的使用</li>\n<li>熟悉 curl 的操作方式</li>\n</ul>\n<h2 id=\"操作流程\">操作流程</h2>\n<p>根据 Cloudflare API 的文档，<a href=\"https://api.cloudflare.com/#access-applications-list-access-applications\" target=\"_blank\" rel=\"noreferrer\">获取 List Access Applications</a>。</p>\n<pre><code>GET accounts/:identifier/access/apps\n</code></pre>\n<p>官方示例：</p>\n<pre><code class=\"language-shell\">curl -X GET \"https://api.cloudflare.com/client/v4/accounts/699d98642c564d2e855e9661899b7252/access/apps\" \\\n     -H \"X-Auth-Email: user@example.com\" \\\n     -H \"X-Auth-Key: c2547eb745079dac9320b638f5e225cf483cc5cfdda41\" \\\n     -H \"Content-Type: application/json\"\n</code></pre>\n<p>对 API 请求数据很简单，X-Auth-Email 很明显是我们账户绑定的邮箱，但是 url 参数中的 identifier 与 X-Auth-Key 的值应该如何获得？</p>\n<h3 id=\"获取自己的-identifier\">获取自己的 identifier</h3>\n<p>登录 Cloudflare 之后，我们可以在主页的 URL 后看到一个看上去像是 ID 的字符串（abcdef1145141919810abcdefabcdefa），没错，这个就是我们的 identifier 。</p>\n<p><img src=\"/stg/hp/images/posts/disable-cloudflare-access-policy/api-tokens.png\" alt=\"Cloudflare 主页\"></p>\n<h3 id=\"获取自己的-x-auth-key\">获取自己的 X-Auth-Key</h3>\n<p>登录 Cloudflare 可在这个页面 <a href=\"https://dash.cloudflare.com/profile/api-tokens\" target=\"_blank\" rel=\"noreferrer\">https://dash.cloudflare.com/profile/api-tokens</a> 的 Global API Key 选项中查看。</p>\n<p><img src=\"/stg/hp/images/posts/disable-cloudflare-access-policy/api-tokens.png\" alt=\"API Tokens 页\"></p>\n<h3 id=\"获取-access-policy-的-id\">获取 Access policy 的 ID</h3>\n<p>有了自己账户的 identifier 与 X-Auth-Key 之后，就可以对上文提到的 API 发送请求了，以下是我开启 Access policy 后对该 API 发送请求的结果，我们可以得到 Access policy 的 ID <code>ffffffff-1145-1419-1981-ffffffff</code>。</p>\n<pre><code class=\"language-json\">{\n  \"result\": [\n    {\n      \"aud\": \"*\",\n      \"created_at\": \"*\",\n      \"domain\": \"****\",\n      \"id\": \"ffffffff-1145-1419-1981-ffffffff\",\n      \"name\": \"***** - Cloudflare Pages\",\n      \"policies\": [\n        {\n          \"created_at\": \"*\",\n          \"decision\": \"allow\",\n          \"exclude\": [],\n          \"id\": \"****\",\n          \"include\": [\n            {\n              \"email\": {\n                \"email\": \"*@*****.****\"\n              }\n            }\n          ]\n          // ...\n        }\n      ],\n      \"allowed_idps\": [\"*-****-*****\"],\n      \"auto_redirect_to_identity\": false,\n      \"session_duration\": \"24h\",\n      \"ssh_logging_enabled\": false,\n      \"uid\": \"****-****-*\",\n      \"updated_at\": \"\",\n      \"type\": \"self_hosted\",\n      \"app_launcher_visible\": false\n    }\n  ],\n  \"success\": true,\n  \"errors\": [],\n  \"messages\": []\n}\n</code></pre>\n<h3 id=\"关闭-access-policy\">关闭 Access policy</h3>\n<p>有了 Access policy 的 ID 之后，就可以使用<a href=\"https://api.cloudflare.com/#access-applications-delete-access-application\" target=\"_blank\" rel=\"noreferrer\">删除 Access Application 的接口</a>关闭 Access policy。Cloudflare 是使用 RESTful 规范设计的 API，删除接口的 URL 就是将上文提到的接口，将 GET 换成 DELETE，并在最后加上 ID。</p>\n<pre><code>DELETE accounts/:identifier/access/apps/:uuid\n</code></pre>\n<pre><code class=\"language-shell\">curl -X DELETE \"https://api.cloudflare.com/client/v4/accounts/abcdef1145141919810abcdefabcdefa/access/apps/ffffffff-1145-1419-1981-ffffffff\" \\\n     -H \"X-Auth-Email: user@example.com\" \\\n     -H \"X-Auth-Key: c2547eb745079dac9320b638f5e225cf483cc5cfdda41\" \\\n     -H \"Content-Type: application/json\"\n</code></pre>\n<p>发送 DELETE 请求后，返回结果类似以下的结果，状态码为 202 (Accepted)，恭喜你，你已经成功关闭了<del>这该死的</del> Access policy！</p>\n<p>如果返回了其他的结果，请根据返回的结果中的提示，修改你请求中的参数。</p>\n<pre><code class=\"language-json\">{\n  \"result\": {\n    \"id\": \"ffffffff-1145-1419-1981-ffffffff\"\n  },\n  \"success\": true,\n  \"errors\": [],\n  \"messages\": []\n}\n</code></pre>\n<h2 id=\"参考资料\">参考资料</h2>\n<ul>\n<li><a href=\"https://community.cloudflare.com/t/how-can-i-disable-the-access-policy-of-cloudflare-pages/292358/8\" target=\"_blank\" rel=\"noreferrer\">https://community.cloudflare.com/t/how-can-i-disable-the-access-policy-of-cloudflare-pages/292358/8</a>)</li>\n</ul>"}]]}]
